<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="C++,NS3," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="详细内容请参考ns-3 tutorial Models, Attributes and Reality一个模型在定义上是现实的抽象。最终是由代码的作者决定所谓的“抽象的范围”以及“可用性”。 在某些情况下，比如csma，确定没有被建模的部分是相当容易的。通过阅读模块描述（csma.h）发现其没有冲突检测。 如你所见的，ns-3提供了一些用户能够直接改变模块行为的Attributes。考虑CsmaN">
<meta name="keywords" content="C++,NS3">
<meta property="og:type" content="article">
<meta property="og:title" content="ns3 Building Topologies second.cc">
<meta property="og:url" content="http://yoursite.com/ns3 Building a Wireless Network Topology/index.html">
<meta property="og:site_name" content="Fatart&#39;s blog">
<meta property="og:description" content="详细内容请参考ns-3 tutorial Models, Attributes and Reality一个模型在定义上是现实的抽象。最终是由代码的作者决定所谓的“抽象的范围”以及“可用性”。 在某些情况下，比如csma，确定没有被建模的部分是相当容易的。通过阅读模块描述（csma.h）发现其没有冲突检测。 如你所见的，ns-3提供了一些用户能够直接改变模块行为的Attributes。考虑CsmaN">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2017-08-23T13:05:49.027Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ns3 Building Topologies second.cc">
<meta name="twitter:description" content="详细内容请参考ns-3 tutorial Models, Attributes and Reality一个模型在定义上是现实的抽象。最终是由代码的作者决定所谓的“抽象的范围”以及“可用性”。 在某些情况下，比如csma，确定没有被建模的部分是相当容易的。通过阅读模块描述（csma.h）发现其没有冲突检测。 如你所见的，ns-3提供了一些用户能够直接改变模块行为的Attributes。考虑CsmaN">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/ns3 Building a Wireless Network Topology/"/>





  <title>ns3 Building Topologies second.cc | Fatart's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Fatart's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/ns3 Building a Wireless Network Topology/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fatart's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">ns3 Building Topologies second.cc</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-21T18:28:25+08:00">
                2017-08-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NS3/" itemprop="url" rel="index">
                    <span itemprop="name">NS3</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>详细内容请参考<a href="https://www.nsnam.org/docs/release/3.26/tutorial/html/building-topologies.html" target="_blank" rel="external">ns-3 tutorial</a></p>
<h1 id="Models-Attributes-and-Reality"><a href="#Models-Attributes-and-Reality" class="headerlink" title="Models, Attributes and Reality"></a>Models, Attributes and Reality</h1><p>一个模型在定义上是现实的抽象。最终是由代码的作者决定所谓的“抽象的范围”以及“可用性”。</p>
<p>在某些情况下，比如csma，确定没有被建模的部分是相当容易的。通过阅读模块描述（csma.h）发现其没有冲突检测。</p>
<p>如你所见的，ns-3提供了一些用户能够直接改变模块行为的Attributes。考虑CsmaNetDevice的两个Attributes：MTU和EncapsulationMode。</p>
<p>MTU:Maximum Transmission Unit，这是Protocol Data Unit(PDU)的最大size。在CsmaNetDevice中，MTU默认值为1500bytes</p>
<h1 id="Building-a-Wireless-Network-Topology"><a href="#Building-a-Wireless-Network-Topology" class="headerlink" title="Building a Wireless Network Topology"></a>Building a Wireless Network Topology</h1><p>在这节，我们将拓展对ns-3 网络设备和信道的知识，涉及到组件一个无线网络。ns-3 提供了一系列802.11模型，该模型努力提供一个准确的802.11 MAC-level实现和一个“并不是特别慢”的802.11a PHY-Level实现。</p>
<p>在代码中，如果你改变了nCsma，它将会改变“extra” CSMA节点的数量。相似的，你可以设置nWifi来控制仿真中创建的STA(station)节点数量。在无线网络中有一个AP(Access point)。</p>
<h4 id="include-wifi-and-mobility-headfiles"><a href="#include-wifi-and-mobility-headfiles" class="headerlink" title="include wifi and mobility headfiles"></a>include wifi and mobility headfiles</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#include &quot;ns3/core-module.h&quot;</div><div class="line">#include &quot;ns3/point-to-point-module.h&quot;</div><div class="line">#include &quot;ns3/network-module.h&quot;</div><div class="line">#include &quot;ns3/applications-module.h&quot;</div><div class="line">#include &quot;ns3/wifi-module.h&quot;</div><div class="line">#include &quot;ns3/mobility-module.h&quot;</div><div class="line">#include &quot;ns3/csma-module.h&quot;</div><div class="line">#include &quot;ns3/internet-module.h&quot;</div></pre></td></tr></table></figure>
<p>将创建的网络topology如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// Default Network Topology</div><div class="line">//</div><div class="line">//   Wifi 10.1.3.0</div><div class="line">//                 AP</div><div class="line">//  *    *    *    *</div><div class="line">//  |    |    |    |    10.1.1.0</div><div class="line">// n5   n6   n7   n0 -------------- n1   n2   n3   n4(S)</div><div class="line">//          client   point-to-point  |    |    |    |</div><div class="line">//                                   ================</div><div class="line">//                                     LAN 10.1.2.0</div></pre></td></tr></table></figure>
<p>我们在p2p链路的左边添加了一个新的网络设备，为无线网络的AP(Access Point)，新的10.1.3.0 wifi网络具有nwifi个STA(station)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">using namespace ns3; //使用ns3 命名空间</div><div class="line"></div><div class="line">NS_LOG_COMPONENT_DEFINE (&quot;ThirdScriptExample&quot;); //定义log component</div></pre></td></tr></table></figure>
<p>添加command line parameter</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">bool verbose = true;</div><div class="line">uint32_t nCsma = 3;</div><div class="line">uint32_t nWifi = 3;</div><div class="line"></div><div class="line">CommandLine cmd;</div><div class="line">cmd.AddValue (&quot;nCsma&quot;, &quot;Number of \&quot;extra\&quot; CSMA nodes/devices&quot;, nCsma);</div><div class="line">cmd.AddValue (&quot;nWifi&quot;, &quot;Number of wifi STA devices&quot;, nWifi);</div><div class="line">cmd.AddValue (&quot;verbose&quot;, &quot;Tell echo applications to log if true&quot;, verbose);</div><div class="line"></div><div class="line">cmd.Parse (argc,argv);</div><div class="line"></div><div class="line">if (verbose)</div><div class="line">  &#123;</div><div class="line">    LogComponentEnable(&quot;UdpEchoClientApplication&quot;, LOG_LEVEL_INFO);</div><div class="line">    LogComponentEnable(&quot;UdpEchoServerApplication&quot;, LOG_LEVEL_INFO);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">NodeContainer p2pNodes;  </div><div class="line">p2pNodes.Create (2);  //创建两个p2p节点 N0 N1</div><div class="line"></div><div class="line">PointToPointHelper pointToPoint;</div><div class="line">pointToPoint.SetDeviceAttribute (&quot;DataRate&quot;, StringValue (&quot;5Mbps&quot;)); //设定device参数</div><div class="line">pointToPoint.SetChannelAttribute (&quot;Delay&quot;, StringValue (&quot;2ms&quot;)); //设定channel参数</div><div class="line"></div><div class="line">NetDeviceContainer p2pDevices;</div><div class="line">p2pDevices = pointToPoint.Install (p2pNodes); //安装p2p网络设备</div><div class="line"></div><div class="line">NodeContainer csmaNodes;</div><div class="line">csmaNodes.Add (p2pNodes.Get (1)); //在第二个p2p节点基础上创建一个csma节点 N1</div><div class="line">csmaNodes.Create (nCsma);         //创建“extra” csma node N2  N3 N4</div><div class="line"></div><div class="line">CsmaHelper csma;</div><div class="line">csma.SetChannelAttribute (&quot;DataRate&quot;, StringValue (&quot;100Mbps&quot;));</div><div class="line">csma.SetChannelAttribute (&quot;Delay&quot;, TimeValue (NanoSeconds (6560)));</div><div class="line"></div><div class="line">NetDeviceContainer csmaDevices;</div><div class="line">csmaDevices = csma.Install (csmaNodes); //安装csma网络设备</div><div class="line"></div><div class="line">```</div></pre></td></tr></table></figure>
<p>NodeContainer wifiStaNodes;   //声明wifi节点<br>wifiStaNodes.Create (nWifi);  //创建nwifi个 STA节点 N5 N6 N7<br>NodeContainer wifiApNode = p2pNodes.Get (0); //在p2p第1个节点上创建一个wifiAp节点N0<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<p>YansWifiChannelHelper channel = YansWifiChannelHelper::Default ();<br>YansWifiPhyHelper phy = YansWifiPhyHelper::Default ();<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">为了简单起见，代码使用了默认的PHY layer配置和channe 模型。</div><div class="line"></div><div class="line">创建一个channel对象并将其和PHY layer对象联系起来，确保YansWifiPhyHelper创建的PHY level对象共享相同的底层信道，这样，他们共享相同信道才能通信和互相干扰。</div></pre></td></tr></table></figure></p>
<p>phy.SetChannel (channel.Create ());<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">一旦PHY helper配置完成，我们将要配置MAC layer</div></pre></td></tr></table></figure></p>
<p>WifiHelper wifi = WifiHelper::Default ();<br>wifi.SetRemoteStationManager (“ns3::AarfWifiManager”); //使用 AARF algorithm</p>
<p>NqosWifiMacHelper mac = NqosWifiMacHelper::Default ();<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">配置type of MAC</div></pre></td></tr></table></figure></p>
<p>Ssid ssid = Ssid (“ns-3-ssid”);<br>mac.SetType (“ns3::StaWifiMac”,<br>  “Ssid”, SsidValue (ssid),<br>  “ActiveProbing”, BooleanValue (false));<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">代码首先创建了一个802.11SSID(service set identifier)，我们用它来设定MAC layer的SSid的参数。</div><div class="line"></div><div class="line">使用“ns3::StaWifiMac”设定mac layer的类型，这里是STA类型。</div><div class="line"></div><div class="line">NqosWifiMacHelper将会确保创建的MAC对象不具备Attributs-QosSupported功能。</div><div class="line"></div><div class="line">上面两点说明：创建了一个non-Qos non-AP station（STA）。</div></pre></td></tr></table></figure></p>
<p>NetDeviceContainer staDevices;<br>staDevices = wifi.Install (phy, mac, wifiStaNodes); //在STA device上设定phy，mac，node<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<p>mac.SetType (“ns3::ApWifiMac”,          //设定Ap 类型的mac<br>             “Ssid”, SsidValue (ssid));<br>NetDeviceContainer apDevices;<br>apDevices = wifi.Install (phy, mac, wifiApNode); //安装于AP node之上<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">### 移动模块</div><div class="line"></div><div class="line">我们希望STA节点是移动的，在一个有限的box里移动。我们希望AP node是固定的，使用MobilityHelper实现。</div></pre></td></tr></table></figure></p>
<p>MobilityHelper mobility;</p>
<p>mobility.SetPositionAllocator (“ns3::GridPositionAllocator”,<br>  “MinX”, DoubleValue (0.0),<br>  “MinY”, DoubleValue (0.0),<br>  “DeltaX”, DoubleValue (5.0),<br>  “DeltaY”, DoubleValue (10.0),<br>  “GridWidth”, UintegerValue (3),<br>  “LayoutType”, StringValue (“RowFirst”));<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">告知MobilityHelper使用一个2维grid来初始放置STA节点。</div></pre></td></tr></table></figure></p>
<p>mobility.SetMobilityModel (“ns3::RandomWalk2dMobilityModel”,<br>  “Bounds”, RectangleValue (Rectangle (-50, 50, -50, 50)));</p>
<p>  mobility.Install (wifiStaNodes);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">We have arranged our nodes on an initial grid, but now we need to tell them how to move. We choose the RandomWalk2dMobilityModel which has the nodes move in a random direction at a random speed around inside a bounding box.</div></pre></td></tr></table></figure></p>
<p>mobility.SetMobilityModel (“ns3::ConstantPositionMobilityModel”);<br>mobility.Install (wifiApNode);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<p>InternetStackHelper stack;<br>stack.Install (csmaNodes);<br>stack.Install (wifiApNode);<br>stack.Install (wifiStaNodes);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">install stack</div></pre></td></tr></table></figure></p>
<p>Ipv4AddressHelper address;</p>
<p>address.SetBase (“10.1.1.0”, “255.255.255.0”);<br>Ipv4InterfaceContainer p2pInterfaces;<br>p2pInterfaces = address.Assign (p2pDevices);</p>
<p>address.SetBase (“10.1.2.0”, “255.255.255.0”);<br>Ipv4InterfaceContainer csmaInterfaces;<br>csmaInterfaces = address.Assign (csmaDevices);</p>
<p>address.SetBase (“10.1.3.0”, “255.255.255.0”);<br>address.Assign (staDevices); //先分配的stadevice 所以 sta地址从 10.1.3.1~ 10.1.3.3<br>address.Assign (apDevices);  //ap IP 10.1.3.4</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">assign IP</div></pre></td></tr></table></figure>
<p>UdpEchoServerHelper echoServer (9);</p>
<p>ApplicationContainer serverApps = echoServer.Install (csmaNodes.Get (nCsma));<br>serverApps.Start (Seconds (1.0));<br>serverApps.Stop (Seconds (10.0));<br>UdpEchoClientHelper echoClient (csmaInterfaces.GetAddress (nCsma), 9);<br>echoClient.SetAttribute (“MaxPackets”, UintegerValue (1));<br>echoClient.SetAttribute (“Interval”, TimeValue (Seconds (1.0)));<br>echoClient.SetAttribute (“PacketSize”, UintegerValue (1024));</p>
<p>ApplicationContainer clientApps =<br>  echoClient.Install (wifiStaNodes.Get (nWifi - 1));<br>clientApps.Start (Seconds (2.0));<br>clientApps.Stop (Seconds (10.0));<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">install AP</div></pre></td></tr></table></figure></p>
<p>Ipv4GlobalRoutingHelper::PopulateRoutingTables ();<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">enable global routing</div></pre></td></tr></table></figure></p>
<p>pointToPoint.EnablePcapAll (“third”);<br>phy.EnablePcap (“third”, apDevices.Get (0));<br>csma.EnablePcap (“third”, csmaDevices.Get (0), true);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">enable pcap</div><div class="line"></div><div class="line">## 运行代码</div></pre></td></tr></table></figure></p>
<p>$ ./waf –run scratch/third</p>
<p>$ ./waf –run scratch/third –vis  //带python图像<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<p>At time 2s client sent 1024 bytes to 10.1.2.4 port 9<br>At time 2.01796s server received 1024 bytes from 10.1.3.3 port 49153<br>At time 2.01796s server sent 1024 bytes to 10.1.3.3 port 49153<br>At time 2.03364s client received 1024 bytes from 10.1.2.4 port 9<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">在文件夹里存在4个pcap文件</div></pre></td></tr></table></figure></p>
<p>third-0-0.pcap  third-0-1.pcap  third-1-0.pcap  third-1-1.pcap<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">third-0-0.pcap： Node 0 - PointToPoint Netdevice</div><div class="line">third-0-1.pcap： Node 0 - Wifi Netdevice</div><div class="line">third-1-0.pcap： Node 1 - PointToPoint Netdevice</div><div class="line">third-1-1.pcap： Node 1 - Csma Netdevice</div></pre></td></tr></table></figure></p>
<p>$ tcpdump -nn -tt -r third-0-1.pcap<br>reading from file third-0-1.pcap, link-type IEEE802_11 (802.11)<br>0.000025 Beacon (ns-3-ssid) [6.0<em> 9.0 12.0 18.0 24.0 36.0 48.0 54.0 Mbit] IBSS<br>0.000308 Assoc Request (ns-3-ssid) [6.0 9.0 12.0 18.0 24.0 36.0 48.0 54.0 Mbit]<br>0.000324 Acknowledgment RA:00:00:00:00:00:08<br>0.000402 Assoc Response AID(0) :: Successful<br>0.000546 Acknowledgment RA:00:00:00:00:00:0a<br>0.000721 Assoc Request (ns-3-ssid) [6.0 9.0 12.0 18.0 24.0 36.0 48.0 54.0 Mbit]<br>0.000737 Acknowledgment RA:00:00:00:00:00:07<br>0.000824 Assoc Response AID(0) :: Successful<br>0.000968 Acknowledgment RA:00:00:00:00:00:0a<br>0.001134 Assoc Request (ns-3-ssid) [6.0 9.0 12.0 18.0 24.0 36.0 48.0 54.0 Mbit]<br>0.001150 Acknowledgment RA:00:00:00:00:00:09<br>0.001273 Assoc Response AID(0) :: Successful<br>0.001417 Acknowledgment RA:00:00:00:00:00:0a<br>0.102400 Beacon (ns-3-ssid) [6.0</em> 9.0 12.0 18.0 24.0 36.0 48.0 54.0 Mbit] IBSS<br>0.204800 Beacon (ns-3-ssid) [6.0<em> 9.0 12.0 18.0 24.0 36.0 48.0 54.0 Mbit] IBSS<br>0.307200 Beacon (ns-3-ssid) [6.0</em> 9.0 12.0 18.0 24.0 36.0 48.0 54.0 Mbit] IBSS</p>
<p>$ tcpdump -nn -tt -r third-0-0.pcap<br>reading from file third-0-0.pcap, link-type PPP (PPP)<br>2.008151 IP 10.1.3.3.49153 &gt; 10.1.2.4.9: UDP, length 1024<br>2.026758 IP 10.1.2.4.9 &gt; 10.1.3.3.49153: UDP, length 1024</p>
<p>$ tcpdump -nn -tt -r third-1-0.pcap<br>reading from file third-1-0.pcap, link-type PPP (PPP)<br>2.011837 IP 10.1.3.3.49153 &gt; 10.1.2.4.9: UDP, length 1024<br>2.023072 IP 10.1.2.4.9 &gt; 10.1.3.3.49153: UDP, length 1024</p>
<p>$ tcpdump -nn -tt -r third-1-1.pcap<br>reading from file third-1-1.pcap, link-type EN10MB (Ethernet)<br>2.017837 ARP, Request who-has 10.1.2.4 (ff:ff:ff:ff:ff:ff) tell 10.1.2.1, length 50<br>2.017861 ARP, Reply 10.1.2.4 is-at 00:00:00:00:00:06, length 50<br>2.017861 IP 10.1.3.3.49153 &gt; 10.1.2.4.9: UDP, length 1024<br>2.022966 ARP, Request who-has 10.1.2.1 (ff:ff:ff:ff:ff:ff) tell 10.1.2.4, length 50<br>2.022966 ARP, Reply 10.1.2.1 is-at 00:00:00:00:00:03, length 50<br>2.023072 IP 10.1.2.4.9 &gt; 10.1.3.3.49153: UDP, length 1024<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># 修改MobilityModel trace source</div><div class="line"></div><div class="line">我们通过和MobilityModel的 course change trace source</div><div class="line"></div><div class="line">ns3 trace system 分成 trace source 和 trace sinks，我们提供函数连接这两个。我们将使用mobility model预先定义的course change trace souce来发起trace 时间。</div><div class="line"></div><div class="line">我们将需要写一个trace sink和source连接，这个sink将会为我们显式一些数据。</div><div class="line"></div><div class="line">我们可以在[API](https://www.nsnam.org/docs/release/3.26/doxygen/classns3_1_1_mobility_model.html)中，找到mobility model的trace source。</div></pre></td></tr></table></figure></p>
<p>TraceSources</p>
<ul>
<li>CourseChange ：The value of the position and/or velocity vector changed<br>Callback signature: ns3::MobilityModel::TracedCallback<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
</li>
</ul>
<p>Config Paths</p>
<p>ns3::MobilityModel is accessible through the following paths with Config::Set and Config::Connect:</p>
<p>“/NodeList/[i]/$ns3::MobilityModel”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">在 NS_LOG_COMPONENT_DEFINE后添加如下代码（trace sink）：</div></pre></td></tr></table></figure></p>
<p>void<br>CourseChange (std::string context, Ptr<const mobilitymodel=""> model)<br>{<br>  Vector position = model-&gt;GetPosition ();<br>  NS_LOG_UNCOND (context &lt;&lt;<br>    “ x = “ &lt;&lt; position.x &lt;&lt; “, y = “ &lt;&lt; position.y);<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">我们会在每一此STA位置变化的情况下输出位置，使用用Config::Connect，在Simulator::Run前加：</div></pre></td></tr></table></figure></const></p>
<p>std::ostringstream oss;<br>oss &lt;&lt;<br>  “/NodeList/“ &lt;&lt; wifiStaNodes.Get (nWifi - 1)-&gt;GetId () &lt;&lt;<br>  “/$ns3::MobilityModel/CourseChange”;</p>
<p>Config::Connect (oss.str (), MakeCallback (&amp;CourseChange));<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">在[API](https://www.nsnam.org/docs/release/3.26/doxygen/group__config.html#ga4014f151241cd0939b6cb64409605736)中查看得到的connect函数</div></pre></td></tr></table></figure></p>
<p>void ns3::Config::Connect(std::string path, const CallbackBase &amp; cb)</p>
<p>Parameters<br>   [in] path  A path to match trace sources<br>   [in] cb    The callback to connect to the matching trace sources<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">我们可以看到在代码中第一个输入参数为 trace source的访问链接，使用ostringstream::str得到例如以下的形式（和API中的形式一致），指向的是NodeList的第7个节点</div></pre></td></tr></table></figure></p>
<p>/NodeList/7/$ns3::MobilityModel/CourseChange<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">我们将node 7 的trace source和我们编写的trace sink函数（coursechange）链接起来，使用Config::Connect函数。</div></pre></td></tr></table></figure></p>
<p>‘build’ finished successfully (5.989s)<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 10, y = 0<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 10.3841, y = 0.923277<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 10.2049, y = 1.90708<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 10.8136, y = 1.11368<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 10.8452, y = 2.11318<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 10.9797, y = 3.10409<br>At time 2s client sent 1024 bytes to 10.1.2.4 port 9<br>At time 2.01796s server received 1024 bytes from 10.1.3.3 port 49153<br>At time 2.01796s server sent 1024 bytes to 10.1.3.3 port 49153<br>At time 2.03364s client received 1024 bytes from 10.1.2.4 port 9<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 11.3273, y = 4.04175<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 12.013, y = 4.76955<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 12.4317, y = 5.67771<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 11.4607, y = 5.91681<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 12.0155, y = 6.74878<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 13.0076, y = 6.62336<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 12.6285, y = 5.698<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 13.32, y = 4.97559<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 13.1134, y = 3.99715<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 13.8359, y = 4.68851<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 13.5953, y = 3.71789<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 12.7595, y = 4.26688<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 11.7629, y = 4.34913<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 11.2292, y = 5.19485<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 10.2344, y = 5.09394<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 9.3601, y = 4.60846<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 8.40025, y = 4.32795<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 9.14292, y = 4.99761<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 9.08299, y = 5.99581<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 8.26068, y = 5.42677<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 8.35917, y = 6.42191<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 7.66805, y = 7.14466<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 6.71414, y = 6.84456<br>/NodeList/7/$ns3::MobilityModel/CourseChange x = 6.42489, y = 7.80181<br>```</p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>Thanks For Donate!</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>Donate</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt=" WeChat Pay"/>
        <p>WeChat Pay</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt=" Alipay"/>
        <p>Alipay</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/C/" rel="tag"># C++</a>
          
            <a href="/tags/NS3/" rel="tag"># NS3</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/ns3 Building Topologies/" rel="next" title="ns3 Building Topologies second.cc">
                <i class="fa fa-chevron-left"></i> ns3 Building Topologies second.cc
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/Modal verb-would have, could have, should have/" rel="prev" title="Modal verb-would have, could have, should have">
                Modal verb-would have, could have, should have <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="" />
          <p class="site-author-name" itemprop="name"></p>
           
              <p class="site-description motion-element" itemprop="description">�������ɣ�������̫��</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Models-Attributes-and-Reality"><span class="nav-number">1.</span> <span class="nav-text">Models, Attributes and Reality</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Building-a-Wireless-Network-Topology"><span class="nav-number">2.</span> <span class="nav-text">Building a Wireless Network Topology</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#include-wifi-and-mobility-headfiles"><span class="nav-number">2.0.0.1.</span> <span class="nav-text">include wifi and mobility headfiles</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder"></span>

  
</div>


  <div class="powered-by">
    由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
  </div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">
    主题 &mdash;
    <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
      NexT.Mist
    </a>
  </div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
